---
title: go web编程学习笔记
---

[TOC]

# 一、Go与Web应用

## 大规模可扩展的Web应用通常需要具备以下特质：

- 可扩展
  - 垂直扩展：提升单台设备的CPU数量或者性能
  - 水平扩展：通过增加计算机的数量来提升性能
- 模块化
- 可维护
- 高性能

## http请求

### http请求报文组成

（1）请求行（方法+URI+HTTP版本）

（2）零个或任意多个请求首部

（3）一个空行

（4）可选的报文主体

### HTTP1.1的方法

**HTTP1.1要求必须实现的只有GET和HEAD方法**

GET——命令服务器返回指定的资源

HEAD——如同GET但是不要求服务器返回报文主体

POST——命令服务器将报文主体中的数据传递给URI指定的资源，至于服务器具体会对这些数据执行什么动作则取决于服务器本身

PUT——命令服务器将URI指定的资源设置为报文主体中的数据，如果URI指定的位置已经有数据存在，则用报文主体中的数据代替已有的数据。如果资源尚未存在，那么在URI指定的位置上新创建一个资源。

DELETE——命令服务器删除URI指定的资源

TRACE——命令服务器返回请求本身。通过这个方法，客户端可以知道介于它和服务器之间的其他服务器是如何处理请求的。

OPTIONS——命令服务器返回它支持的HTTP方法列表

CONNECT——命令服务器与客户端建立一个网络连接。这个方法通常用于设置SSL隧道以开启HTTPS功能

PATCH——命令服务器使用报文主体中的数据对URL指定的资源进行修改

### 安全的请求方法

如果一个HTTP方法只要求服务器提供信息而不会对服务器的状态做如何修改，那么这个方法就是安全的。

GET、HEAD、OPTION、TRACE是安全的，POST、PUT、DELETE不表示安全的。

### 幂等的请求方法

如果一个HTTP方法在使用相同的数据进行二次调用的时候，不会对服务器的状态造成任何改变，那么这个方法就是幂等的。

所有的安全方法都是幂等的，此外PUT、DELETE方法也是幂等的；重复的POST请求是否改变服务器状态是由服务器自身决定的，所以POST方法既不安全也非幂等。

## HTTP响应

### HTTP响应组成

（1）状态行（状态码 +原因短语）

（2）零个或任意数量的响应首部

（3）一个空行

（4）一个可选的报文主体

## URI

### URI是URN和URL的并集，这里提及的URI指的是URL

### URI组成

<方案名称> : <分层部分>[ ? <查询参数> ] [ # <片段> ]

方案名称：如http等

分层部分：包含了资源的识别信息，以分层方式组织。如果以双斜线（//）开头，说明白敖汉了可选的用户信息，这些信息以@符号结尾，后跟分层路径。每个路径都由一连串的分段（segment）组成，各个分段之间使用单斜线（/）分割。

查询参数：可选部分，以？开头，以&符号连接

片段：可选部分，对URI定义的次级资源进行标识

URI举例：

```URI
http://sausheong:password@www.example.com/docs/file?name=sausheong&location=singapore#summery
```

URI中的保留字符用%加上字符对应的ASCII十六进制字节值表示，如空格，ASCII编码10进制为32，16进制为20，URI中表示为`%20`

## Web应用的各个组成部分

web应用被分为了处理器（handler）和模板引擎（template engine）两部分

### 处理器

Web应用中的处理器除了要接受和处理客户端发来的请求，还需要调用模板引擎，然后由模板引擎生成HTML并把数据填充至将要传回客户端的响应报文当中。

用MVC模式来讲，处理器既是控制器也是模型。在理想MVC实现中，控制器应该质包含路由代码以及HTTP报文的解包打包逻辑；而模型应该包含应用的逻辑以及数据。

# 三、接收请求

1. 注入日志记录、安全检查和错误处理这样的操作通常被称为横切关注点，我们可以使用串联（chaining）技术分割代码中的横切关注点。

   ```go
   func log(h http.Handler) http.Handler {
   	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
   		fmt.Printf("Handler called - %T\n", h)
   		h.ServeHTTP(w, r)
   	})
   }
   ```

2. 